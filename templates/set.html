{% extends "layout.html" %}

{%block title %}
    Set budget
{% endblock %}

{% block main %}
    {% if warning == True %}
    <div class="alert alert-success text-center" role="alert">
        Entry registered.
    </div>
    {% elif message != '' %}
    <div class="alert alert-danger text-center" role="alert">
          {{message}}
    </div>
    {% endif %}

    <!-- First Dropdown selection menu (choose table)-->
    <main>
      <form method="POST" action="/set">
          <div class="form1 form-group col-8">
            <select class="form-control" id="choose_table" name="chosen_table" onchange='if(this.value != 0) { this.form.submit();  }'>
                <option> Select table </option>
                <option value="Income">Income </option>
                <option value="Monthly Budget">Monthly Budget</option>
                <option value="Daily Budget">Daily Budget</option>
                <option value="Savings">Savings</option>
              </select>
          </div>
      </form>
      {% if title != 'None' %}
      <!-- Create table -->
        <table class="table" id="table-striped">
        <thead>
            <tr>
            {% if title == "Income" %}
                <th scope="col">Item</th>
                <th scope="col">Value</th>
                <th scope="col">Delete</th>


            {% elif title == 'Monthly Budget' or title == 'Daily Budget' %}
                <th scope="col">Item</th>
                <th scope="col">Fixed Value</th>
                <th scope="col">Expected for the month</th>
                <th scope="col">Spend</th>
                <th scope="col">Available</th>
                <th scope="col">Delete</th>


            {% elif title == 'Savings' %}
                <th scope="col">Item</th>
                <th scope="col">Fixed Value</th>
                <th scope="col">Expected for the month</th>
                <th scope="col">Saved</th>
                <th scope="col">Available</th>
                <th scope="col">Delete</th>

        
            {% endif %}
            </tr>
        </thead>
        <tbody>
            <h5>{{title}} </h5>
            <!-- Read the n variable to get different stocks -->
            {% for i in table_values %}
            <tr>
              <form action="/set" method="POST">
            <!-- Create a new row and then add cells-->
            <th scope="row"><span data-toggle="modal" data-target="#mymodal_text" class="clickable_icon"><i class="fas fa-pen-square"></i></span>  {{ i["item"]}}</th>      
                {% for key, value in i.items() %}
                <!--p>{{key, value}}</p-->
                    {% if key == 'spent' or key == 'available' or key == 'saved' %}
                      <td >{{ value }}</td>   
                    {% elif key != 'user_id' and key != 'item' and key != 'id' and key != 'value' and value != None %}
                      <td ><span data-toggle="modal" data-target="#mymodal_number" class="clickable_icon"><i class="fas fa-pen-square"></i></span>  {{ value }}</td>
                    {% elif value == None %}
                      <td><span class="clickable item"><i class="fas fa-pen-square"></i> - </td>
                    {% elif key == 'value' %}
                      <td><span data-toggle="modal" data-target="#mymodal_number" class="clickable item"><i class="fas fa-pen-square"></i> ${{ '%0.2f'| format(value) }}</td>
                    {% elif key == 'id' %}
                    <input type="hidden" name="row_id" value="{{value}}">
                    <input type="hidden" name="table_id" value="{{title}}">
                    {% endif %}
                {% endfor %}
                <td> <button type="submit" class="btn btn-dark btn-rounded btn-sm my-0">Remove</button></td>
                </form>
            </tr>
            {% endfor %}
        </tbody>
        {% endif %}
        </table>
        
      
      
      <!-- Forms to add new row according to each table-->

      {% if title == "Income" %}
      <h4> Add new row</h4>
      <form method="POST" action="/set" >
        <div class="form-row">
          <div class="form-group col-md-4">
            <input type="text" class="form-control" name="item" required placeholder="New item">
          </div>
          <div class="form-group col-md-6">
            <input type="number" class="form-control" name="value" required placeholder="Value">
          </div>
        </div>
          <input type="hidden" class="form-control"  name="add_row" value="Income">
        </div>
        <div>
          <button type="submit" class="btn btn-dark">Submit</button>
        </div>
      </form>

      {% elif title == 'Monthly Budget'%}
      <h4> Add new row</h4>
      <form method="POST" action="/set" >
        <div class="form-row">
          <div class="form-group col-md-4">
            <input type="text" class="form-control" name="item" required placeholder="New item">
          </div>
          <div class="form-group col-md-6">
            <input type="number" class="form-control" name="fixed" required placeholder="Value" value="0">
          </div>
          <div class="form-group col-md-6">
            <input type="number" class="form-control" name="expected" value="0" placeholder="Value" >
          </div>
        </div>
          <input type="hidden" class="form-control"  name="add_row" value="Monthly Budget">
        </div>
        <div>
          <button type="submit" class="btn btn-dark">Submit</button>
        </div>
      </form>
      
      {% elif title == 'Daily Budget'%}
      <h4> Add new row</h4>
      <form method="POST" action="/set" >
        <div class="form-row">
          <div class="form-group col-md-4">
            <input type="text" class="form-control" name="item" required placeholder="New item">
          </div>
          <div class="form-group col-md-6">
            <input type="number" class="form-control" name="fixed"  required placeholder="Value" value="0">
          </div>
          <div class="form-group col-md-6">
            <input type="number" class="form-control" name="expected" value="0" placeholder="Value" >
          </div>
        </div>
          <input type="hidden" class="form-control"  name="add_row" value="Daily Budget">
        </div>
        <div>
          <button type="submit" class="btn btn-dark">Submit</button>
        </div>
      </form>

      {% elif title == 'Savings'%}
      <h4> Add new row</h4>
      <form method="POST" action="/set" >
        <div class="form-row">
          <div class="form-group col-md-4">
            <input type="text" class="form-control" name="item" required placeholder="New item">
          </div>
          <div class="form-group col-md-6">
            <input type="number" class="form-control" name="fixed" required placeholder="Value" value="0">
          </div>
          <div class="form-group col-md-6">
            <input type="number" class="form-control" name="expected" value="0" placeholder="Value" >
          </div>
        </div>
          <input type="hidden" class="form-control"  name="add_row" value="Savings">
        </div>
        <div>
          <button type="submit" class="btn btn-dark">Submit</button>
        </div>
      </form>

      {% endif %}
  
  </main>
      
  <!-- Modals to edit the row-->

  <!-- Modal for text-->
  <div class="modal" id="mymodal_number" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header text-center">
          <h4 class="modal-title w-100 font-weight-bold">Update</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body mx-3">
          <div class="md-form mb-5 text-center">
              <input type="number" step="0.01" id="set_value" class="form-control validate" name="new_name">
              <label data-error="wrong" data-success="right" for="defaultbudget" class="text_modal">New value</label>
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button class="btn btn-dark">Save</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for numbers-->
  <div class="modal" id="mymodal_text" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header text-center">
          <h4 class="modal-title w-100 font-weight-bold">Update</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body mx-3">
          <div class="md-form mb-5 text-center">
              <input type="text" id="set_item_name" class="form-control validate" name="new_name">
              <label data-error="wrong" data-success="right" for="defaultbudget" class="text_modal">New name</label>
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button class="btn btn-dark">Save</button>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}